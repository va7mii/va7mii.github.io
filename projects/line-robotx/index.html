<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> ESP-32 Line Follower | Kevin Zhang </title> <meta name="author" content="Kevin (He-Jun) Zhang"> <meta name="description" content="Line following robot + FreeRTOS + Bluetooth"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/mii_prof.png?0f8f72a34ec5389de76285f821dae24c"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://va7mii.github.io/projects/line-robotx/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Kevin Zhang </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/talks/">Talks </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/photos/">Photos </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">ESP-32 Line Follower</h1> <p class="post-description">Line following robot + FreeRTOS + Bluetooth</p> </header> <article> <blockquote> <p><strong>TL;DR</strong> – Using Bluetooth and FreeRTOS to read data from robot and control it wirelessly.</p> </blockquote> <p>Source code: <a href="https://github.com/va7mii/IGEN230-Line-Robot" rel="external nofollow noopener" target="_blank">https://github.com/va7mii/IGEN230-Line-Robot</a></p> <p>In IGEN 230 (2nd year project course), we had to built a line following robot using ESP-32. To make things interesting, I decided to use Bluetooth to control the robot and help with calibration.</p> <p>The code makes uses FreeRTOS (real-time operating system) to facilitate running multiple tasks at once</p> <ul> <li> <strong>Pros:</strong> Easier to organize code, allow for precise timing of things to be run, opportunity to improve C-coding skills</li> <li> <strong>Cons:</strong> Big learning curve, risk of resetting the ESP32 due to a memory leak,</li> </ul> <p>When connected to Bluetooth, the user can connect the ESP32 with any device that can do Serial inputs (e.g. Windows laptop, Android device).</p> <p>Bluetooth Output: IR sensor data on a Serial terminal The user can also input commands to control the robot using the format [character] [number] [some other number]</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="p">[</span><span class="n">leftSpeed</span><span class="p">]</span> <span class="p">[</span><span class="n">rightSpeed</span><span class="p">]</span> <span class="c1">// used in the joystick to control left and right motors</span>
<span class="n">c</span> <span class="c1">// to trigger a calibration reading</span>
<span class="n">m</span> <span class="c1">// manual control</span>
<span class="n">a</span> <span class="c1">// switch back to automatic line following</span>
<span class="n">p</span><span class="o">/</span><span class="n">i</span><span class="o">/</span><span class="n">d</span><span class="o">/</span><span class="n">b</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="c1">// adjust Kp, Ki, Kd [PID parameters] or a base speed on the fly</span>
</code></pre></div></div> <p>Here is an example what commands would be read from the Serial in the robot:</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c</span> 		<span class="c1">// Reads the sensor values from the white surface</span>
<span class="n">c</span>	 	<span class="c1">// Reads values from the black line</span>
<span class="c1">// Robot is moving</span>
<span class="n">b</span> <span class="mi">45</span> 		<span class="c1">// Change base speed to 45</span>
<span class="n">p</span> <span class="mi">30</span> 		<span class="c1">//Change the Kp parameter (in PID control) to 30</span>
<span class="n">m</span> 		<span class="c1">// Change to manual mode [or controller ‘A’ button]</span>
<span class="p">[</span><span class="n">controlling</span> <span class="n">the</span> <span class="n">robot</span> <span class="n">with</span> <span class="n">the</span> <span class="n">controller</span><span class="err">’</span><span class="n">s</span> <span class="n">two</span> <span class="n">joysticks</span><span class="p">]</span>
<span class="n">s</span> <span class="mi">10</span> <span class="mi">10</span> 	<span class="c1">// Set left motor = 10, right motor = 10 to go straight </span>
<span class="n">s</span> <span class="mi">10</span> <span class="o">-</span><span class="mi">10</span> 	<span class="c1">// leftmotor = 10, rightmotor = -10, a right turn</span>
<span class="n">s</span> <span class="mi">0</span> <span class="mi">0</span> 		<span class="c1">//leftmotor = 0, rightmotor = 0, stop robot</span>
<span class="n">a</span> 		<span class="c1">//switch back to an automatic line follow mode</span>
<span class="c1">//[turn off] / [reset button]</span>
</code></pre></div></div> <p>Based on the diagram, the ESP32 runs Serial Read, Sensor Task, and Motor Task concurrently</p> <p>When doing the calibration, the ESP32 outputs like Calibrating white base: sensor0 = 21.00, sensor1 = 31.00, sensor2 = 0.00, sensor3 = 29.00, sensor4 = 0.00, However for calibrating the black line, the ESP32 takes the maximum reading it received so far to be able capture the maximum possible sensor value when it reads a black line.</p> <p>Using a Nintendo Switch Pro controller Using the left and right joysticks (Y-axis) we can control the speed of the left and right motors (both directions). A Python script (using PyGame library) converts the joystick inputs into” s [leftMotor] [rightMotor]” keyboard commands to control the motor Because of that, we require the user to press the right trigger “R” in order to control the joystick Other keybindings Left trigger “L” to press “c” for calibration “A” button to press “m” for manual mode “B” button to press “a” for auto mode</p> <pre><code class="language-mermaid">flowchart TD
        A(["Start"])
        A --&gt; B{"Decision"}
        B --&gt; C["Option A"]
        B --&gt; D["Option B"]
</code></pre> <h2 id="bom-highlights">BOM Highlights</h2> <table> <thead> <tr> <th>Part</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td>ESP32‑WROOM‑32D</td> <td>MCU + Wi‑Fi/BLE</td> </tr> <tr> <td>L298N H‑bridge</td> <td>Motor driver</td> </tr> <tr> <td>QR1114 IR sensors ×5</td> <td>Line detection (IR LED + Phototransistor)</td> </tr> </tbody> </table> <div class="row"> <div class="col-sm mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/line-robotx/front_view-480.webp 480w,/assets/img/projects/line-robotx/front_view-800.webp 800w,/assets/img/projects/line-robotx/front_view-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/projects/line-robotx/front_view.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Top view" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/line-robotx/robot_on_track-480.webp 480w,/assets/img/projects/line-robotx/robot_on_track-800.webp 800w,/assets/img/projects/line-robotx/robot_on_track-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/projects/line-robotx/robot_on_track.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="IR sensor array PCB" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/line-robotx/robotx-calibrate-480.webp 480w,/assets/img/projects/line-robotx/robotx-calibrate-800.webp 800w,/assets/img/projects/line-robotx/robotx-calibrate-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/projects/line-robotx/robotx-calibrate.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Live PID plot" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Left: Front View of Robot. Centre: Robot on Track. Right: Calibration info on Serial Monitor </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Kevin (He-Jun) Zhang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js" integrity="sha256-1rA678n2xEx7x4cTZ5x4wpUCj6kUMZEZ5cxLSVSFWxw=" crossorigin="anonymous"></script> <script defer src="/assets/js/mermaid-setup.js?38ca0a0126f7328d2d9a46bad640931f" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>